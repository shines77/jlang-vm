<html lang="zh-cn">
<header>
<meta charset="utf-8" />
<title>Test - fibonacci(n)</title>
<script language="javascript">
function fibonacci(n) {
    if (n >= 3)
        return fibonacci(n - 1) + fibonacci(n -2);
    else
        return 1;
}

function run_fib() {
    var num_ctl = document.getElementsByName("n")[0];
    var num = num_ctl.value;
    if (num === undefined || (typeof num === "string" && num === "")) {
        alert("n 必须是数字，不能为空或字符串！");
        return false;
    }
    var n = parseInt(num, 10);

    var fib_n_ctl = document.getElementsByName("fib_n")[0];
    var elapsed_time_ctl = document.getElementsByName("elapsed_time")[0];
    var last_time_ctl = document.getElementsByName("last_time")[0];

    var startTime, endTime, elaspedTime;
    startTime = new Date().getTime();
    var fib_n = fibonacci(n);
    endTime = new Date().getTime();
    elaspedTime = endTime - startTime;

    fib_n_ctl.style.visibility = "visible";
    elapsed_time_ctl.style.visibility = "visible";
    last_time_ctl.style.visibility = "visible";

    fib_n_ctl.enabled = "true";
    elapsed_time_ctl.enabled = "true";
    last_time_ctl.enabled = "true";

    fib_n_ctl.value = fib_n;
    elapsed_time_ctl.value = elaspedTime;
    last_time_ctl.value = new Date().toString();

    var run_btn = document.getElementsByName("run_btn")[0];
    run_btn.value = "开始结算"
    run_btn.enabled = "true";

    var run_result_div = document.getElementsByName("run_result")[0];
    run_result_div.style.display = "block";
    return true;
}

function test_fib() {
    var num_ctl = document.getElementsByName("n")[0];
    var num = num_ctl.value;
    if (num === undefined || (typeof num === "string" && num === "")) {
        alert("n 必须是数字，不能为空或字符串！");
        return false;
    }
    var n = parseInt(num, 10);
    num_ctl.value = n.toString();

    var run_btn = document.getElementsByName("run_btn")[0];
    run_btn.value = "计算中..."
    run_btn.enabled = "false";

    var fib_n_ctl = document.getElementsByName("fib_n")[0];
    var elapsed_time_ctl = document.getElementsByName("elapsed_time")[0];
    var last_time_ctl = document.getElementsByName("last_time")[0];

    fib_n_ctl.value = "";
    elapsed_time_ctl.value = "";
    last_time_ctl.value = "";

    fib_n_ctl.enabled = "false";
    elapsed_time_ctl.enabled = "false";
    last_time_ctl.enabled = "false";

    fib_n_ctl.style.visibility = "hidden";
    elapsed_time_ctl.style.visibility = "hidden";
    last_time_ctl.style.visibility = "hidden";

    var run_result_div = document.getElementsByName("run_result")[0];
    run_result_div.style.display = "none";

    if (true) {
        var startTime, endTime, elaspedTime;
        startTime = new Date().getTime();
        var fib_n = fibonacci(n);
        endTime = new Date().getTime();
        elaspedTime = endTime - startTime;

        fib_n_ctl.style.visibility = "visible";
        elapsed_time_ctl.style.visibility = "visible";
        last_time_ctl.style.visibility = "visible";

        fib_n_ctl.enabled = "true";
        elapsed_time_ctl.enabled = "true";
        last_time_ctl.enabled = "true";

        fib_n_ctl.value = fib_n;
        elapsed_time_ctl.value = elaspedTime;
        last_time_ctl.value = new Date().toString();

        run_btn.value = "开始结算"
        run_btn.enabled = "true";
    } else {
        last_time_ctl.value = new Date().toString();
        setTimeout(run_fib(), 500);
    }

    run_result_div.style.display = "block";
    return true;
}

function reset_ui() {
    var run_btn = document.getElementsByName("run_btn")[0];
    var run_result_div = document.getElementsByName("run_result")[0];
    var fib_n_ctl = document.getElementsByName("fib_n")[0];
    var elapsed_time_ctl = document.getElementsByName("elapsed_time")[0];
    var last_time_ctl = document.getElementsByName("last_time")[0];

    run_result_div.style.display = "block";

    run_btn.value = "开始结算"
    run_btn.enabled = "true";

    fib_n_ctl.value = "";
    elapsed_time_ctl.value = "";
    last_time_ctl.value = "";

    fib_n_ctl.enabled = "false";
    elapsed_time_ctl.enabled = "false";
    last_time_ctl.enabled = "false";

    fib_n_ctl.style.visibility = "visible";
    elapsed_time_ctl.style.visibility = "visible";
    last_time_ctl.style.visibility = "visible";
}
</script>
</header>
<body>
<p><br />n = ? <input name="n" type="number" value="40" size="6" maxlength="8"></p>
<div name="run_result">
<p>fibonacci(n): <input name="fib_n" type="string" value="" size="16" maxlength="20"></p>
<p>耗时：<input name="elapsed_time" type="string" value="" size="12" maxlength="16"> 毫秒</p>
<p>时间戳：<input name="last_time" type="string" value="" size="50" maxlength="56"></p>
</div>
<p><br />&nbsp;| &nbsp;<input name="run_btn" type="button" onclick="test_fib()" value="开始计算"> &nbsp; | &nbsp;<input name="reset_btn" type="button" onclick="reset_ui()" value="重置结果">&nbsp; | &nbsp;</p>
</body>
</html>
